Bootstrap: docker
From: alpine:latest

%files

    banner.txt /etc/ssh/banner.txt
    sshd.conf /etc/ssh/sshd_config.d/sshd.conf
    sftpuser_key /home/sftpuser/.ssh/authorized_keys

%post
    apk add openssh-server
    ssh-keygen -A

    addgroup sftp
    adduser -D -h /home/sftpuser -s /bin/sh -G sftp sftpuser
    #echo "sshuser:password" | chpasswd # directive "PasswordAuthentication yes" must be present in sshd.conf

    echo "Include /etc/ssh/sshd_config.d/sshd.conf" >> /etc/ssh/sshd_config

    mkdir -p /home/sftpuser/.ssh

    chmod 700 /home/sftpuser/.ssh
    chmod 600 /home/sftpuser/.ssh/*

%startscript
    date
    date 1>&2
    /usr/sbin/sshd -D -p 8000 # -d -d -d 
    echo "sshd exited. exit code: $?"
