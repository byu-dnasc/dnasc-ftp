Bootstrap: docker
From: alpine:latest

%files

    banner /etc/ssh/banner
    sshd.conf /etc/ssh/sshd_config.d/sshd.conf
    keys/host_key /etc/ssh/host_key
    keys/host_key.pub /etc/ssh/host_key.pub
    keys/user_key.pub /etc/ssh/authorized_keys/{{ user }}
    
%post

    apk add openssh-server

    chmod 600 /etc/ssh/host_key
    chmod 600 /etc/ssh/authorized_keys/{{ user }}

%runscript

    echo "Running as user: $(whoami)"
    echo "Received arguments for sshd: $*"
    /usr/sbin/sshd -D "$@"
    echo "sshd exited with code $?"

%startscript

    /usr/sbin/sshd -D "$@"
    echo "sshd exited with code $?"